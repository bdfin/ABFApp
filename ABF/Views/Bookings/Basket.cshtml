@model ABF.ViewModels.FullBasketViewModel

@{
    ViewBag.Title = "BasketwithAddOns";

    var addons = Model.addontickets;
    var events = Model.eventtickets;
    var member = Model.Membership;

}

<h2>Full Basket (With Add-Ons)</h2>
<hr/>
<p>tickets will appear here if you have any</p>
@if(events!=null&&events.Count>0)
{
    <h3>Tickets:</h3>
    <table>
        <tr>
            <th>Event ID</th>
            <th>Event</th>
            <th>Author</th>
            <th>Date</th>
            <th>Start Time</th>
            <th>Location</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Subtotal</th>
        </tr>

        @foreach (var item in events)
        {
            <tr>
                <td>@item.Event.Id</td>
                <td>@item.Event.Name</td>
                <td>@item.Event.Author</td>
                <td>@item.Event.Date.ToString("dd MMM")</td>
                <td>@item.Event.StartTime.ToString("HH:mm")</td>
                <td>@item.LocationName</td>
                <td>@item.Event.TicketPrice</td>
                <td>@item.Quantity</td>
                <td>
                    @{ var subtotal = @item.Event.TicketPrice * @item.Quantity; }
                    @subtotal
                </td>
            </tr>

            <tr>
                @{
                    if (Model.addontickets != null)
                    {
                        foreach (var ao in Model.addontickets)
                        {
                            if (ao.Key.EventId == item.Event.Id)
                            {
                                <td></td>
                                <td colspan="2"><b>Add-On</b>@ao.Key.Name</td>
                                <td colspan="3"></td>
                                <td>£@ao.Key.Price</td>
                                <td>@ao.Value</td>
                                <td>
                                    @{ var x = ao.Key.Price * ao.Value; }
                                    £@x
                                </td>
                            }

                        }
                    }
                }
            </tr>
        }

    </table>
}
<hr/>


<hr/>
<p>Membership will appear here if one is in the basket</p>
@if (member != null)
{
    <h3>Membership</h3>
    <table>
        <tr>
            <th>Membership Type</th>
            <th>Valid From</th>
            <th>Expires</th>
            <th>Price</th>
        </tr>
        <tr>
            <td>@member.Type</td>
            <td>@DateTime.Today.ToString("dd MMM yyyy")</td>
            <td>31 Dec @DateTime.Today.ToString("yyyy")</td>
            <td>£@member.Price</td>
        </tr>
    </table>
}